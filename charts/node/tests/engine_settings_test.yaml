suite: Engine settings tests
templates:
  - engine-cm.yaml
values:
  - values/happy.values.yaml
tests:
  - it: should create engine ConfigMap
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
  - it: should not create engine ConfigMap if existingConfigMap is set
    set:
      engine.settings.existingConfigMap: "test"
    asserts:
      - hasDocuments:
          count: 0
  - it: should specify backup nodes if set
    set:
      engine.settings.eth_backup.enabled: true
      engine.settings.eth_backup.ws_endpoint: "ws://test"
      engine.settings.eth_backup.http_endpoint: "http://test"
      engine.settings.dot_backup.enabled: true
      engine.settings.dot_backup.ws_endpoint: "ws://test"
      engine.settings.dot_backup.http_endpoint: "http://test"
      engine.settings.btc_backup.enabled: true
      engine.settings.btc_backup.http_endpoint: "http://test"
      engine.settings.btc_backup.rpc_user: "test"
      engine.settings.btc_backup.rpc_password: "test"
      engine:
        image:
          current_tag: 0.9.3
          prv_tag: 0.10.0
        settings:
          migration_mode: true
    asserts:
      - hasDocuments:
          count: 1
      - matchRegex:
          path: "data['prv.Settings.toml']"
          pattern: "[(eth|dot|btc)].backup_rpc"